<div class="admin-container">
  <app-sidebar></app-sidebar>
  
  <div class="admin-content">
    <div class="header-section">
      <h2>Servicios/Departamentos</h2>
      <button class="btn-primary" (click)="openCreateForm()">
        + Nuevo Servicio/Departamento
      </button>
    </div>

    <!-- Mensajes -->
    <div *ngIf="errorMessage" class="alert alert-error">
      {{ errorMessage }}
    </div>
    <div *ngIf="successMessage" class="alert alert-success">
      {{ successMessage }}
    </div>

    <!-- Modal de Formulario -->
    <div *ngIf="showForm" class="modal-overlay" (click)="closeForm()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>{{ isEditing ? 'Editar Servicio/Departamento' : 'Nuevo Servicio/Departamento' }}</h3>
          <button class="modal-close" (click)="closeForm()" type="button">√ó</button>
        </div>
        <div class="modal-body">
          <form #servicioDepartamentoForm="ngForm" (ngSubmit)="save(servicioDepartamentoForm)">
            <div class="form-group">
              <label for="abreviacion">Abreviaci√≥n *</label>
              <input 
                type="text" 
                id="abreviacion" 
                [ngModel]="servicioDepartamento.abreviacion" 
                (ngModelChange)="servicioDepartamento.abreviacion = $event.toUpperCase()"
                name="abreviacion"
                #abreviacion="ngModel"
                required
                minlength="2"
                maxlength="20"
                placeholder="Ej: PSI, TO, FON"
                style="text-transform: uppercase;">
              <div *ngIf="abreviacion.invalid && abreviacion.touched" class="error-message">
                <span *ngIf="abreviacion.errors?.['required']">La abreviaci√≥n es requerida</span>
                <span *ngIf="abreviacion.errors?.['minlength']">La abreviaci√≥n debe tener al menos 2 caracteres</span>
                <span *ngIf="abreviacion.errors?.['maxlength']">La abreviaci√≥n no puede exceder 20 caracteres</span>
              </div>
            </div>

            <div class="form-group">
              <label for="nombre">Nombre *</label>
              <input 
                type="text" 
                id="nombre" 
                [ngModel]="servicioDepartamento.nombre" 
                (ngModelChange)="servicioDepartamento.nombre = $event.toUpperCase()"
                name="nombre"
                #nombre="ngModel"
                required
                minlength="2"
                maxlength="100"
                placeholder="Ej: Psicolog√≠a, Terapia Ocupacional"
                style="text-transform: uppercase;">
              <div *ngIf="nombre.invalid && nombre.touched" class="error-message">
                <span *ngIf="nombre.errors?.['required']">El nombre es requerido</span>
                <span *ngIf="nombre.errors?.['minlength']">El nombre debe tener al menos 2 caracteres</span>
                <span *ngIf="nombre.errors?.['maxlength']">El nombre no puede exceder 100 caracteres</span>
              </div>
            </div>

            <div class="modal-actions">
              <button type="button" class="btn-secondary" (click)="closeForm()">
                Cancelar
              </button>
              <button type="submit" class="btn-primary" [disabled]="servicioDepartamentoForm.invalid">
                {{ isEditing ? 'Actualizar' : 'Crear' }}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Tabla de Servicios/Departamentos -->
    <div class="card">
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Abreviaci√≥n</th>
            <th>Nombre</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let servicio of serviciosDepartamentos">
            <td>{{ servicio.id }}</td>
            <td><strong>{{ servicio.abreviacion }}</strong></td>
            <td>{{ servicio.nombre }}</td>
            <td>
              <span [class]="servicio.activo ? 'badge-success' : 'badge-inactive'">
                {{ servicio.activo ? 'Activo' : 'Inactivo' }}
              </span>
            </td>
            <td>
              <div class="actions-cell">
                <button 
                  class="btn-icon btn-edit" 
                  (click)="openEditForm(servicio)"
                  title="Editar">
                  ‚úèÔ∏è
                </button>
                <label class="toggle-switch" [title]="servicio.activo ? 'Desactivar' : 'Activar'">
                  <input 
                    type="checkbox" 
                    [checked]="servicio.activo"
                    (change)="toggleActivo(servicio)">
                  <span class="toggle-slider"></span>
                </label>
                <button 
                  class="btn-icon btn-delete" 
                  (click)="deleteServicioDepartamento(servicio.id!)"
                  title="Eliminar">
                  üóëÔ∏è
                </button>
              </div>
            </td>
          </tr>
          <tr *ngIf="serviciosDepartamentos.length === 0">
            <td colspan="5" class="no-data">No hay servicios/departamentos registrados</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

