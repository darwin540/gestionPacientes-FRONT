<div class="admin-container">
  <app-sidebar></app-sidebar>
  
  <div class="admin-content">
    <div class="header-section">
      <h2>Tipos de Documento</h2>
      <button class="btn-primary" (click)="openCreateForm()">
        + Nuevo Tipo de Documento
      </button>
    </div>

    <!-- Mensajes -->
    <div *ngIf="errorMessage" class="alert alert-error">
      {{ errorMessage }}
    </div>
    <div *ngIf="successMessage" class="alert alert-success">
      {{ successMessage }}
    </div>

    <!-- Modal de Formulario -->
    <div *ngIf="showForm" class="modal-overlay" (click)="closeForm()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>{{ isEditing ? 'Editar Tipo de Documento' : 'Nuevo Tipo de Documento' }}</h3>
          <button class="modal-close" (click)="closeForm()" type="button">√ó</button>
        </div>
        <div class="modal-body">
          <form #tipoDocumentoForm="ngForm" (ngSubmit)="save(tipoDocumentoForm)">
            <div class="form-group">
              <label for="nombre">Nombre *</label>
              <input 
                type="text" 
                id="nombre" 
                [ngModel]="tipoDocumento.nombre" 
                (ngModelChange)="tipoDocumento.nombre = $event.toUpperCase()"
                name="nombre"
                #nombre="ngModel"
                required
                minlength="2"
                maxlength="50"
                placeholder="Ej: DNI, Pasaporte, C√©dula"
                style="text-transform: uppercase;">
              <div *ngIf="nombre.invalid && nombre.touched" class="error-message">
                <span *ngIf="nombre.errors?.['required']">El nombre es requerido</span>
                <span *ngIf="nombre.errors?.['minlength']">El nombre debe tener al menos 2 caracteres</span>
                <span *ngIf="nombre.errors?.['maxlength']">El nombre no puede exceder 50 caracteres</span>
              </div>
            </div>

            <div class="form-group">
              <label for="descripcion">Descripci√≥n</label>
              <textarea 
                id="descripcion" 
                [ngModel]="tipoDocumento.descripcion" 
                (ngModelChange)="tipoDocumento.descripcion = $event ? $event.toUpperCase() : ''"
                name="descripcion"
                rows="3"
                maxlength="255"
                placeholder="Descripci√≥n opcional del tipo de documento"
                style="text-transform: uppercase;"></textarea>
            </div>

            <div class="modal-actions">
              <button type="button" class="btn-secondary" (click)="closeForm()">
                Cancelar
              </button>
              <button type="submit" class="btn-primary" [disabled]="tipoDocumentoForm.invalid">
                {{ isEditing ? 'Actualizar' : 'Crear' }}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Tabla de Tipos de Documento -->
    <div class="card">
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Descripci√≥n</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <ng-container *ngIf="tiposDocumento.length > 0">
            <tr *ngFor="let tipo of tiposDocumento; trackBy: trackByTipoId">
              <td>{{ tipo.id }}</td>
              <td><strong>{{ tipo.nombre }}</strong></td>
              <td>{{ tipo.descripcion || '-' }}</td>
              <td>
                <span [class]="tipo.activo ? 'badge-success' : 'badge-inactive'">
                  {{ tipo.activo ? 'Activo' : 'Inactivo' }}
                </span>
              </td>
              <td>
                <div class="actions-cell">
                  <button 
                    class="btn-icon btn-edit" 
                    (click)="openEditForm(tipo)"
                    title="Editar">
                    ‚úèÔ∏è
                  </button>
                  <label class="toggle-switch" [title]="tipo.activo ? 'Desactivar' : 'Activar'">
                    <input 
                      type="checkbox" 
                      [checked]="tipo.activo"
                      (change)="toggleActivo(tipo)">
                    <span class="toggle-slider"></span>
                  </label>
                  <button 
                    class="btn-icon btn-delete" 
                    (click)="deleteTipoDocumento(tipo.id!)"
                    title="Eliminar">
                    üóëÔ∏è
                  </button>
                </div>
              </td>
            </tr>
          </ng-container>
          <tr *ngIf="tiposDocumento.length === 0 && !errorMessage">
            <td colspan="5" class="no-data">No hay tipos de documento registrados</td>
          </tr>
          <tr *ngIf="errorMessage">
            <td colspan="5" class="no-data error-text">{{ errorMessage }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

